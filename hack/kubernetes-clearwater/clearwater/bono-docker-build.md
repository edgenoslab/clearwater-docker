Table of contents

Customize `Dockerfile` to `docker build`

    [tangfx@localhost base-docker]$ mkdir ../bono-docker && cd ../bono-docker/

    [tangfx@localhost bono-docker]$ vi Dockerfile

    [tangfx@localhost bono-docker]$ vi Makefile

    [tangfx@localhost bono-docker]$ ls
    Dockerfile  Makefile

    [tangfx@localhost bono-docker]$ make IMG_TAG=1611180614.gitrev-c2da9c9
    /usr/bin/docker build --tag=docker.io/tangfeixiong/clearwater-bono:1611180614.gitrev-c2da9c9 --file=../../../../bono/Dockerfile.tangfx ../../../../bono
    Sending build context to Docker daemon 7.168 kB
    Step 1 : FROM docker.io/tangfeixiong/clearwater-base-onbuild:1611180614.gitrev-c2da9c9
    # Executing 2 build triggers...
    Step 1 : EXPOSE 22
     ---> Using cache
    Step 1 : CMD /usr/bin/supervisord -c /etc/supervisor/supervisord.conf
     ---> Using cache
     ---> e16796a8d558
    Step 2 : MAINTAINER tangfeixiong<tangfx128@gmail.com>
     ---> Using cache
     ---> e8f24f33160d
    Step 3 : USER root
     ---> Using cache
     ---> dbc83c55f6a4
    Step 4 : ADD *supervisord.conf /etc/supervisor/conf.d/
     ---> 68daa5b24d5c
    Removing intermediate container b53f3c16b97f
    Step 5 : RUN apt-get update &&   DEBIAN_FRONTEND=noninteractive apt-get install -y --force-yes bono &&   sed -e 's/\(echo 0 > \/proc\/sys\/kernel\/yama\/ptrace_scope\)/# \0/g' -i /etc/init.d/bono &&   apt-get update &&   DEBIAN_FRONTEND=noninteractive apt-get install -y --force-yes restund &&   sed -e 's/\(echo 0 > \/proc\/sys\/kernel\/yama\/ptrace_scope\)/# \0/g' -i /etc/init.d/restund &&   mv /etc/supervisor/conf.d/bono.supervisord.conf /etc/supervisor/conf.d/bono.conf &&   mv /etc/supervisor/conf.d/restund.supervisord.conf /etc/supervisor/conf.d/restund.conf &&   mv /etc/supervisor/conf.d/clearwater-group.supervisord.conf /etc/supervisor/conf.d/clearwater-group.conf
     ---> Running in bafe6000f788
    Ign http://10.64.33.1:48080 binary/ InRelease
    Hit http://10.64.33.1:48080 binary/ Release.gpg
    Hit http://10.64.33.1:48080 binary/ Release
    Hit http://10.64.33.1:48080 binary/ Packages
    Ign http://mirrors.aliyun.com trusty InRelease
    Hit http://mirrors.aliyun.com trusty-updates InRelease
    Hit http://mirrors.aliyun.com trusty-security InRelease
    Hit http://mirrors.aliyun.com trusty Release.gpg
    Hit http://mirrors.aliyun.com trusty Release
    Hit http://mirrors.aliyun.com trusty-updates/main Sources
    Hit http://mirrors.aliyun.com trusty-updates/restricted Sources
    Hit http://mirrors.aliyun.com trusty-updates/universe Sources
    Hit http://mirrors.aliyun.com trusty-updates/main amd64 Packages
    Hit http://mirrors.aliyun.com trusty-updates/restricted amd64 Packages
    Hit http://mirrors.aliyun.com trusty-updates/universe amd64 Packages
    Hit http://mirrors.aliyun.com trusty-security/main Sources
    Hit http://mirrors.aliyun.com trusty-security/restricted Sources
    Hit http://mirrors.aliyun.com trusty-security/universe Sources
    Hit http://mirrors.aliyun.com trusty-security/main amd64 Packages
    Hit http://mirrors.aliyun.com trusty-security/restricted amd64 Packages
    Hit http://mirrors.aliyun.com trusty-security/universe amd64 Packages
    Hit http://mirrors.aliyun.com trusty/main Sources
    Hit http://mirrors.aliyun.com trusty/restricted Sources
    Hit http://mirrors.aliyun.com trusty/universe Sources
    Hit http://mirrors.aliyun.com trusty/main amd64 Packages
    Hit http://mirrors.aliyun.com trusty/restricted amd64 Packages
    Hit http://mirrors.aliyun.com trusty/universe amd64 Packages
    Reading package lists...
    Reading package lists...
    Building dependency tree...
    Reading state information...
    The following extra packages will be installed:
      clearwater-log-cleanup clearwater-socket-factory clearwater-tcp-scalability
      libboost-filesystem1.54.0 libboost-regex1.54.0 libboost-system1.54.0
      libboost-thread1.54.0 libevent-2.0-5 libevent-core-2.0-5
      libevent-pthreads-2.0-5 libicu52 libpci3 libperl5.18 libsnmp-base libsnmp30
      sprout-libs
    Suggested packages:
      restund bono-dbg clearwater-logging snmp-mibs-downloader
    The following NEW packages will be installed:
      bono clearwater-log-cleanup clearwater-socket-factory
      clearwater-tcp-scalability libboost-filesystem1.54.0 libboost-regex1.54.0
      libboost-system1.54.0 libboost-thread1.54.0 libevent-2.0-5
      libevent-core-2.0-5 libevent-pthreads-2.0-5 libicu52 libpci3 libperl5.18
      libsnmp-base libsnmp30 sprout-libs
    0 upgraded, 17 newly installed, 0 to remove and 7 not upgraded.
    Need to get 11.5 MB of archives.
    After this operation, 46.1 MB of additional disk space will be used.
    Get:1 http://10.64.33.1:48080/mirror/repo.cw-ngv.com/stable/ binary/ libsnmp-base 5.7.2~dfsg-clearwater4 [224 kB]
    Get:2 http://10.64.33.1:48080/mirror/repo.cw-ngv.com/stable/ binary/ libsnmp30 5.7.2~dfsg-clearwater4 [811 kB]
    Get:3 http://10.64.33.1:48080/mirror/repo.cw-ngv.com/stable/ binary/ clearwater-tcp-scalability 1.0-161102.114310 [14.6 kB]
    Get:4 http://10.64.33.1:48080/mirror/repo.cw-ngv.com/stable/ binary/ clearwater-log-cleanup 1.0-161102.114310 [13.3 kB]
    Get:5 http://10.64.33.1:48080/mirror/repo.cw-ngv.com/stable/ binary/ sprout-libs 1.0-161104.171821 [1,551 kB]
    Get:6 http://10.64.33.1:48080/mirror/repo.cw-ngv.com/stable/ binary/ clearwater-socket-factory 1.0-161102.114310 [32.0 kB]
    Get:7 http://10.64.33.1:48080/mirror/repo.cw-ngv.com/stable/ binary/ bono 1.0-161104.171821 [1,564 kB]
    Get:8 http://mirrors.aliyun.com/ubuntu/ trusty-updates/main libpci3 amd64 1:3.2.1-1ubuntu5.1 [26.3 kB]
    Get:9 http://mirrors.aliyun.com/ubuntu/ trusty-updates/main libboost-system1.54.0 amd64 1.54.0-4ubuntu3.1 [10.1 kB]
    Get:10 http://mirrors.aliyun.com/ubuntu/ trusty-updates/main libboost-filesystem1.54.0 amd64 1.54.0-4ubuntu3.1 [34.2 kB]
    Get:11 http://mirrors.aliyun.com/ubuntu/ trusty-updates/main libicu52 amd64 52.1-3ubuntu0.4 [6,752 kB]
    Get:12 http://mirrors.aliyun.com/ubuntu/ trusty-updates/main libboost-regex1.54.0 amd64 1.54.0-4ubuntu3.1 [261 kB]
    Get:13 http://mirrors.aliyun.com/ubuntu/ trusty-updates/main libboost-thread1.54.0 amd64 1.54.0-4ubuntu3.1 [26.5 kB]
    Get:14 http://mirrors.aliyun.com/ubuntu/ trusty-updates/main libevent-2.0-5 amd64 2.0.21-stable-1ubuntu1.14.04.1 [126 kB]
    Get:15 http://mirrors.aliyun.com/ubuntu/ trusty-updates/main libevent-core-2.0-5 amd64 2.0.21-stable-1ubuntu1.14.04.1 [78.3 kB]
    Get:16 http://mirrors.aliyun.com/ubuntu/ trusty-updates/main libevent-pthreads-2.0-5 amd64 2.0.21-stable-1ubuntu1.14.04.1 [6,126 B]
    Get:17 http://mirrors.aliyun.com/ubuntu/ trusty-updates/main libperl5.18 amd64 5.18.2-2ubuntu1.1 [1,332 B]
    Fetched 11.5 MB in 6s (1,672 kB/s)
    Selecting previously unselected package libpci3:amd64.
    (Reading database ... 24489 files and directories currently installed.)
    Preparing to unpack .../libpci3_1%3a3.2.1-1ubuntu5.1_amd64.deb ...
    Unpacking libpci3:amd64 (1:3.2.1-1ubuntu5.1) ...
    Selecting previously unselected package libboost-system1.54.0:amd64.
    Preparing to unpack .../libboost-system1.54.0_1.54.0-4ubuntu3.1_amd64.deb ...
    Unpacking libboost-system1.54.0:amd64 (1.54.0-4ubuntu3.1) ...
    Selecting previously unselected package libboost-filesystem1.54.0:amd64.
    Preparing to unpack .../libboost-filesystem1.54.0_1.54.0-4ubuntu3.1_amd64.deb ...
    Unpacking libboost-filesystem1.54.0:amd64 (1.54.0-4ubuntu3.1) ...
    Selecting previously unselected package libicu52:amd64.
    Preparing to unpack .../libicu52_52.1-3ubuntu0.4_amd64.deb ...
    Unpacking libicu52:amd64 (52.1-3ubuntu0.4) ...
    Selecting previously unselected package libboost-regex1.54.0:amd64.
    Preparing to unpack .../libboost-regex1.54.0_1.54.0-4ubuntu3.1_amd64.deb ...
    Unpacking libboost-regex1.54.0:amd64 (1.54.0-4ubuntu3.1) ...
    Selecting previously unselected package libboost-thread1.54.0:amd64.
    Preparing to unpack .../libboost-thread1.54.0_1.54.0-4ubuntu3.1_amd64.deb ...
    Unpacking libboost-thread1.54.0:amd64 (1.54.0-4ubuntu3.1) ...
    Selecting previously unselected package libevent-2.0-5:amd64.
    Preparing to unpack .../libevent-2.0-5_2.0.21-stable-1ubuntu1.14.04.1_amd64.deb ...
    Unpacking libevent-2.0-5:amd64 (2.0.21-stable-1ubuntu1.14.04.1) ...
    Selecting previously unselected package libevent-core-2.0-5:amd64.
    Preparing to unpack .../libevent-core-2.0-5_2.0.21-stable-1ubuntu1.14.04.1_amd64.deb ...
    Unpacking libevent-core-2.0-5:amd64 (2.0.21-stable-1ubuntu1.14.04.1) ...
    Selecting previously unselected package libevent-pthreads-2.0-5:amd64.
    Preparing to unpack .../libevent-pthreads-2.0-5_2.0.21-stable-1ubuntu1.14.04.1_amd64.deb ...
    Unpacking libevent-pthreads-2.0-5:amd64 (2.0.21-stable-1ubuntu1.14.04.1) ...
    Selecting previously unselected package libperl5.18.
    Preparing to unpack .../libperl5.18_5.18.2-2ubuntu1.1_amd64.deb ...
    Unpacking libperl5.18 (5.18.2-2ubuntu1.1) ...
    Selecting previously unselected package libsnmp-base.
    Preparing to unpack .../libsnmp-base_5.7.2~dfsg-clearwater4_all.deb ...
    Unpacking libsnmp-base (5.7.2~dfsg-clearwater4) ...
    Selecting previously unselected package libsnmp30:amd64.
    Preparing to unpack .../libsnmp30_5.7.2~dfsg-clearwater4_amd64.deb ...
    Unpacking libsnmp30:amd64 (5.7.2~dfsg-clearwater4) ...
    Selecting previously unselected package clearwater-tcp-scalability.
    Preparing to unpack .../clearwater-tcp-scalability_1.0-161102.114310_all.deb ...
    Unpacking clearwater-tcp-scalability (1.0-161102.114310) ...
    Selecting previously unselected package clearwater-log-cleanup.
    Preparing to unpack .../clearwater-log-cleanup_1.0-161102.114310_all.deb ...
    Unpacking clearwater-log-cleanup (1.0-161102.114310) ...
    Selecting previously unselected package sprout-libs.
    Preparing to unpack .../sprout-libs_1.0-161104.171821_amd64.deb ...
    Unpacking sprout-libs (1.0-161104.171821) ...
    Selecting previously unselected package clearwater-socket-factory.
    Preparing to unpack .../clearwater-socket-factory_1.0-161102.114310_amd64.deb ...
    Unpacking clearwater-socket-factory (1.0-161102.114310) ...
    Selecting previously unselected package bono.
    Preparing to unpack .../bono_1.0-161104.171821_amd64.deb ...
    Unpacking bono (1.0-161104.171821) ...
    Processing triggers for ureadahead (0.100.0-16) ...
    Setting up libpci3:amd64 (1:3.2.1-1ubuntu5.1) ...
    Setting up libboost-system1.54.0:amd64 (1.54.0-4ubuntu3.1) ...
    Setting up libboost-filesystem1.54.0:amd64 (1.54.0-4ubuntu3.1) ...
    Setting up libicu52:amd64 (52.1-3ubuntu0.4) ...
    Setting up libboost-regex1.54.0:amd64 (1.54.0-4ubuntu3.1) ...
    Setting up libboost-thread1.54.0:amd64 (1.54.0-4ubuntu3.1) ...
    Setting up libevent-2.0-5:amd64 (2.0.21-stable-1ubuntu1.14.04.1) ...
    Setting up libevent-core-2.0-5:amd64 (2.0.21-stable-1ubuntu1.14.04.1) ...
    Setting up libevent-pthreads-2.0-5:amd64 (2.0.21-stable-1ubuntu1.14.04.1) ...
    Setting up libperl5.18 (5.18.2-2ubuntu1.1) ...
    Setting up libsnmp-base (5.7.2~dfsg-clearwater4) ...
    Setting up libsnmp30:amd64 (5.7.2~dfsg-clearwater4) ...
    Setting up clearwater-tcp-scalability (1.0-161102.114310) ...
    Setting up clearwater-log-cleanup (1.0-161102.114310) ...
    Setting up sprout-libs (1.0-161104.171821) ...
    Setting up clearwater-socket-factory (1.0-161102.114310) ...
    Processing triggers for ureadahead (0.100.0-16) ...
    Setting up bono (1.0-161104.171821) ...
    Processing triggers for libc-bin (2.19-0ubuntu6.9) ...
    Processing triggers for ureadahead (0.100.0-16) ...
    Ign http://10.64.33.1:48080 binary/ InRelease
    Hit http://10.64.33.1:48080 binary/ Release.gpg
    Hit http://10.64.33.1:48080 binary/ Release
    Ign http://mirrors.aliyun.com trusty InRelease
    Hit http://mirrors.aliyun.com trusty-updates InRelease
    Hit http://mirrors.aliyun.com trusty-security InRelease
    Hit http://10.64.33.1:48080 binary/ Packages
    Hit http://mirrors.aliyun.com trusty Release.gpg
    Hit http://mirrors.aliyun.com trusty-updates/main Sources
    Hit http://mirrors.aliyun.com trusty-updates/restricted Sources
    Hit http://mirrors.aliyun.com trusty-updates/universe Sources
    Hit http://mirrors.aliyun.com trusty-updates/main amd64 Packages
    Hit http://mirrors.aliyun.com trusty-updates/restricted amd64 Packages
    Hit http://mirrors.aliyun.com trusty-updates/universe amd64 Packages
    Hit http://mirrors.aliyun.com trusty Release
    Hit http://mirrors.aliyun.com trusty-security/main Sources
    Hit http://mirrors.aliyun.com trusty-security/restricted Sources
    Hit http://mirrors.aliyun.com trusty-security/universe Sources
    Hit http://mirrors.aliyun.com trusty-security/main amd64 Packages
    Hit http://mirrors.aliyun.com trusty-security/restricted amd64 Packages
    Hit http://mirrors.aliyun.com trusty-security/universe amd64 Packages
    Hit http://mirrors.aliyun.com trusty/main Sources
    Hit http://mirrors.aliyun.com trusty/restricted Sources
    Hit http://mirrors.aliyun.com trusty/universe Sources
    Hit http://mirrors.aliyun.com trusty/main amd64 Packages
    Hit http://mirrors.aliyun.com trusty/restricted amd64 Packages
    Hit http://mirrors.aliyun.com trusty/universe amd64 Packages
    Reading package lists...
    Reading package lists...
    Building dependency tree...
    Reading state information...
    Suggested packages:
      clearwater-logging clearwater-snmpd
    The following NEW packages will be installed:
      restund
    0 upgraded, 1 newly installed, 0 to remove and 7 not upgraded.
    Need to get 610 kB of archives.
    After this operation, 3,893 kB of additional disk space will be used.
    Get:1 http://10.64.33.1:48080/mirror/repo.cw-ngv.com/stable/ binary/ restund 1.0-161104.171821 [610 kB]
    Fetched 610 kB in 0s (20.0 MB/s)
    Selecting previously unselected package restund.
    (Reading database ... 24743 files and directories currently installed.)
    Preparing to unpack .../restund_1.0-161104.171821_amd64.deb ...
    Unpacking restund (1.0-161104.171821) ...
    Processing triggers for ureadahead (0.100.0-16) ...
    Setting up restund (1.0-161104.171821) ...
    Processing triggers for ureadahead (0.100.0-16) ...
     ---> 0d17f8365c52
    Removing intermediate container bafe6000f788
    Step 6 : EXPOSE 3478 3478/udp 5058 5060 5060/udp 5062
     ---> Running in d37874a8078d
     ---> 168582028e03
    Removing intermediate container d37874a8078d
    Successfully built 168582028e03
